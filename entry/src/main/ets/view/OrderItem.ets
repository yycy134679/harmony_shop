import { Order } from '../model/Order';
import { OrderViewModel } from '../viewmodel/OrderViewModel';

/**
 * è®¢å•åˆ—è¡¨é¡¹ç»„ä»¶
 */
@Component
export struct OrderItem {
  @Prop order: Order;
  onViewDetail?: (order: Order) => void;
  private orderViewModel: OrderViewModel = new OrderViewModel();

  build() {
    Column() {
      // è®¢å•å¤´éƒ¨ä¿¡æ¯
      Row() {
        Column() {
          Text(`è®¢å•å·ï¼š${this.order.orderId}`)
            .fontSize(14)
            .fontColor('#333')
            .fontWeight(FontWeight.Medium)
            .width('100%')
            .textAlign(TextAlign.Start)
            .margin({ bottom: 4 })

          Text(this.orderViewModel.formatOrderTime(this.order.createTime))
            .fontSize(12)
            .fontColor('#999')
            .width('100%')
            .textAlign(TextAlign.Start)
        }
        .layoutWeight(1)
        .alignItems(HorizontalAlign.Start)

        Text(this.orderViewModel.getStatusDisplayText(this.order.status))
          .fontSize(14)
          .fontColor(this.orderViewModel.getStatusColor(this.order.status))
          .fontWeight(FontWeight.Medium)
      }
      .width('100%')
      .margin({ bottom: 12 })

      // å•†å“ä¿¡æ¯ï¼ˆæ˜¾ç¤ºç¬¬ä¸€ä¸ªå•†å“å’Œæ€»æ•°é‡ï¼‰
      Row() {
        // å•†å“å›¾ç‰‡ï¼ˆä½¿ç”¨çœŸå®žå•†å“å›¾ç‰‡ï¼‰
        Stack({ alignContent: Alignment.Center }) {
          Image(this.orderViewModel.getMainProductImageUrl(this.order))
            .width(60)
            .height(60)
            .objectFit(ImageFit.Contain)
            .backgroundColor('#FFFFFF')
            .onError(() => {
              console.error(`Failed to load order product image`);
            })
        }
        .width(60)
        .height(60)
        .backgroundColor('#f9f9f9')
        .borderRadius(8)
        .margin({ right: 12 })

        Column() {
          Text(this.orderViewModel.getMainProductName(this.order))
            .fontSize(14)
            .fontColor('#333')
            .maxLines(2)
            .textOverflow({ overflow: TextOverflow.Ellipsis })
            .width('100%')
            .margin({ bottom: 4 })

          Row() {
            Text(`å…±${this.orderViewModel.calculateTotalQuantity(this.order)}ä»¶å•†å“`)
              .fontSize(12)
              .fontColor('#666')

            Blank()

            Text(`Â¥${this.order.totalPrice.toFixed(2)}`)
              .fontSize(16)
              .fontColor('#E41F19')
              .fontWeight(FontWeight.Medium)
          }
          .width('100%')
        }
        .layoutWeight(1)
        .alignItems(HorizontalAlign.Start)
      }
      .width('100%')
      .margin({ bottom: 12 })

      // æ”¶è´§åœ°å€ä¿¡æ¯
      Row() {
        Text('ðŸ“')
          .fontSize(12)
          .margin({ right: 6 })

        Text(`${this.order.shippingAddress.recipientName} ${this.order.shippingAddress.phone}`)
          .fontSize(12)
          .fontColor('#666')
          .layoutWeight(1)
      }
      .width('100%')
      .margin({ bottom: 12 })

      // æ“ä½œæŒ‰é’®åŒºåŸŸ
      Row() {
        Text(`æ”¯ä»˜æ–¹å¼ï¼š${this.order.paymentMethod}`)
          .fontSize(12)
          .fontColor('#666')

        Blank()

        Button('æŸ¥çœ‹è¯¦æƒ…')
          .fontSize(12)
          .fontColor('#ff6b35')
          .backgroundColor('transparent')
          .border({ width: 1, color: '#ff6b35' })
          .borderRadius(4)
          .padding({ left: 12, right: 12, top: 6, bottom: 6 })
          .onClick(() => {
            if (this.onViewDetail) {
              this.onViewDetail(this.order);
            }
          })
      }
      .width('100%')
    }
    .width('100%')
    .padding(16)
    .backgroundColor('#fff')
    .borderRadius(8)
    .margin({ bottom: 12 })
  }
}
