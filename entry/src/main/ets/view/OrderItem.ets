// 202506120141 æ¨å¯Œæ¶›
// è®¢å•åˆ—è¡¨é¡¹ç»„ä»¶ï¼Œç”¨äºŽæ˜¾ç¤ºè®¢å•ä¿¡æ¯

import { Order } from '../model/Order';
import { OrderViewModel } from '../viewmodel/OrderViewModel';

/**
 * è®¢å•åˆ—è¡¨é¡¹ç»„ä»¶
 */
@Component
export struct OrderItem {
  @Prop order: Order;
  onViewDetail?: (order: Order) => void;
  private orderViewModel: OrderViewModel = new OrderViewModel();

  build() {
    Column() {
      // è®¢å•å¤´éƒ¨ä¿¡æ¯
      Row() {
        Column() {
          Text(`è®¢å•å·ï¼š${this.order.orderId}`)
            .fontSize(13)
            .fontColor('#333')
            .fontWeight(FontWeight.Medium)
            .width('100%')
            .textAlign(TextAlign.Start)
            .margin({ bottom: 2 })

          Text(this.orderViewModel.formatOrderTime(this.order.createTime))
            .fontSize(11)
            .fontColor('#999')
            .width('100%')
            .textAlign(TextAlign.Start)
        }
        .layoutWeight(1)
        .alignItems(HorizontalAlign.Start)

        Text(this.orderViewModel.getStatusDisplayText(this.order.status))
          .fontSize(13)
          .fontColor(this.orderViewModel.getStatusColor(this.order.status))
          .fontWeight(FontWeight.Medium)
      }
      .width('100%')
      .margin({ bottom: 6 })

      // å•†å“ä¿¡æ¯ï¼ˆæ˜¾ç¤ºç¬¬ä¸€ä¸ªå•†å“å’Œæ€»æ•°é‡ï¼‰
      Row() {
        // å•†å“å›¾ç‰‡ï¼ˆä½¿ç”¨çœŸå®žå•†å“å›¾ç‰‡ï¼‰
        Stack({ alignContent: Alignment.Center }) {
          Image(this.orderViewModel.getMainProductImageUrl(this.order))
            .width(45)
            .height(45)
            .objectFit(ImageFit.Contain)
            .backgroundColor('#FFFFFF')
            .onError(() => {
              console.error(`Failed to load order product image`);
            })
        }
        .width(45)
        .height(45)
        .backgroundColor('#f9f9f9')
        .borderRadius(6)
        .margin({ right: 10 })

        Column() {
          Text(this.orderViewModel.getMainProductName(this.order))
            .fontSize(13)
            .fontColor('#333')
            .maxLines(1)
            .textOverflow({ overflow: TextOverflow.Ellipsis })
            .width('100%')
            .margin({ bottom: 2 })

          Row() {
            Text(`å…±${this.orderViewModel.calculateTotalQuantity(this.order)}ä»¶å•†å“`)
              .fontSize(11)
              .fontColor('#666')

            Blank()

            Text(`Â¥${this.order.totalPrice.toFixed(2)}`)
              .fontSize(15)
              .fontColor('#E41F19')
              .fontWeight(FontWeight.Medium)
          }
          .width('100%')

          Row() {
            Text(`ðŸ“ ${this.order.shippingAddress.recipientName} ${this.order.shippingAddress.phone}`)
              .fontSize(11)
              .fontColor('#666')
              .maxLines(1)
              .textOverflow({ overflow: TextOverflow.Ellipsis })
              .layoutWeight(1)
              .margin({ top: 2 })

            Button('æŸ¥çœ‹è¯¦æƒ…')
              .fontSize(11)
              .fontColor('#ff6b35')
              .backgroundColor('transparent')
              .border({ width: 1, color: '#ff6b35' })
              .borderRadius(3)
              .padding({ left: 8, right: 8, top: 4, bottom: 4 })
              .onClick(() => {
                if (this.onViewDetail) {
                  this.onViewDetail(this.order);
                }
              })
          }
          .width('100%')
          .margin({ top: 2 })
        }
        .layoutWeight(1)
        .alignItems(HorizontalAlign.Start)
      }
      .width('100%')
    }
    .width('100%')
    .padding(10)
    .backgroundColor('#fff')
    .borderRadius(6)
    .margin({ bottom: 6 })
  }
}
